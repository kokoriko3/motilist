{% extends 'layout.html' %}

{% block title %}è‡ªåˆ†ã®ãƒ—ãƒ©ãƒ³ä¸€è¦§ | Mochi List{% endblock %}

{% block content %}
  <section class="page-section plan-shelf">
    <header class="plan-shelf__header">
      <h1>è‡ªåˆ†ã®æ—…è¡Œãƒ—ãƒ©ãƒ³ã‚’æ¤œç´¢</h1>
      <div class="plan-shelf__actions">
        <form method="get" class="plan-search-form">
          <label class="plan-search">
            <span class="plan-search__icon">ğŸ”</span>
            <input
              type="search"
              name="q"
              placeholder="è‡ªåˆ†ã®æ—…è¡Œãƒ—ãƒ©ãƒ³ã‚’æ¤œç´¢"
              value="{{ query }}"
              maxlength="50"
              required
            />
          </label>
        </form>
        <a class="plan-index__create plan-index__create--ghost" href="{{ url_for('plan.plan_create_form') }}">ï¼‹æ—…è¡Œãƒ—ãƒ©ãƒ³ã‚’ä½œæˆã™ã‚‹</a>
        <form action="{{ url_for('plan.create_dummy_plan') }}" method="post" style="display: inline;">
            <button type="submit" class="plan-index__create plan-index__create--ghost" style="cursor: pointer; background: none; border: none; /* å¿…è¦ã«å¿œã˜ã¦ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ */">
                ï¼‹ãƒ€ãƒŸãƒ¼ãƒ—ãƒ©ãƒ³ã‚’ä½œæˆã™ã‚‹
            </button>
        </form>
      </div>
    </header>

    {% if plans %}
      <div class="plan-tiles plan-tiles--wide">
        {% for plan in plans %}
          {% with detail_url=url_for('plan.plan_detail', template_id=plan.template_id, source='own') %}
            {% include 'components/_plan_card.html' %}
          {% endwith %}
        {% endfor %}
      </div>
      <nav class="plan-pagination" aria-label="ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³">
        <div class="plan-pagination__links">
          {% if page > 1 %}
            <a class="page-nav" href="{{ url_for('plan.plan_list', page=page-1, q=query) }}" aria-label="å‰ã®ãƒšãƒ¼ã‚¸">&lsaquo;</a>
          {% else %}
            <span class="page-nav is-disabled" aria-hidden="true">&lsaquo;</span>
          {% endif %}
          {% for page_number in pagination %}
            {% if page_number %}
              {% if page_number == page %}
                <span class="page-number is-current">{{ page_number }}</span>
              {% else %}
                <a class="page-number" href="{{ url_for('plan.plan_list', page=page_number, q=query) }}">{{ page_number }}</a>
              {% endif %}
            {% else %}
              <span class="page-ellipsis">&hellip;</span>
            {% endif %}
          {% endfor %}
          {% if page < total_pages %}
            <a class="page-nav" href="{{ url_for('plan.plan_list', page=page+1, q=query) }}" aria-label="æ¬¡ã®ãƒšãƒ¼ã‚¸">&rsaquo;</a>
          {% else %}
            <span class="page-nav is-disabled" aria-hidden="true">&rsaquo;</span>
          {% endif %}
        </div>
        <form class="plan-pagination__jump" method="get" action="{{ url_for('plan.plan_list') }}">
          {% if query %}
            <input type="hidden" name="q" value="{{ query }}" />
          {% endif %}
          <label for="plan-page-jump">ãƒšãƒ¼ã‚¸</label>
          <input
            id="plan-page-jump"
            type="number"
            name="page"
            min="1"
            max="{{ total_pages }}"
            value="{{ page }}"
            inputmode="numeric"
          />
          <button type="submit">è¡Œã</button>
        </form>
      </nav>
    {% else %}
      <div class="plan-shelf__empty">
        <p class="plan-shelf__empty-count">æ¤œç´¢çµæœ {{ plans|length }}ä»¶</p>
        <p class="plan-shelf__empty-hint">æ¡ä»¶ã‚’å¤‰ãˆã¦å†æ¤œç´¢ã—ã¦ãã ã•ã„ã€‚</p>
      </div>
    {% endif %}
  </section>
{% endblock %}
