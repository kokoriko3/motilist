{% extends "layout.html" %}
{% block title %}æŒã¡ç‰©ãƒªã‚¹ãƒˆ{% endblock %}
{% block content %}
<section class="plan-shell">
  {% set active_tab = 'checklist' %}
  {% set header_action_label = 'ç·¨é›†' %}
  {% set header_action_href = url_for('plan.checklist_edit') %}
  {% set header_action_class = 'pill-button' %}
  {% include 'plan/_plan_header_tabs.html' %}

  <div class="checklist-body">
    <div class="panel-header">
      {# checklist_toggle.js ãŒã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã«ä½¿ç”¨ã™ã‚‹å±æ€§ #}
      <div class="error-inline" data-checklist-toggle-error hidden>ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ</div>
    </div>

    {# JSå´ãŒ plan_id ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®éš ã—è¦ç´  #}
    <div style="display:none;" data-plan-id="{{ plan.id }}"></div>

    <div class="category-grid">
      {% for category in categories %}
      <article class="category-card">
        <header class="category-title">
          {{ category.name }}
          {% if category.name == 'å¿…éœ€å“' %}ğŸ‘‘{% endif %}
        </header>
        <div class="item-stack">
          {% for item in category['items'] %}
          <button type="button" 
                  class="item-button {% if item.checked %}checked{% endif %}" 
                  data-item-id="{{ item.id }}" 
                  draggable="true"
                  ondragstart="dragStart(event)" 
                  ondragover="dragOver(event)" 
                  ondragleave="dragLeave(event)"
                  ondrop="drop(event)"
                  ondragend="dragEnd(event)"
                  onclick="if(!event.defaultPrevented) this.querySelector('.item-checkbox').click();">
            
            <span class="item-name">
              {% if item.is_required %}ğŸ‘‘{% endif %}
              {{ item.name }}
            </span>
            {% if item.quantity %}<span class="item-qty">æ•°é‡:{{ item.quantity }}</span>{% endif %}
            
            <input type="checkbox" 
                  class="item-checkbox" 
                  data-checklist-toggle 
                  data-checklist-item-id="{{ item.id }}" 
                  {% if item.checked %}checked{% endif %} 
                  style="display:none;"
                  onclick="event.stopPropagation();">
          </button>
          {% endfor %}
        </div>
      </article>
      {% endfor %}
    </div>
  </div>
</section>

{# ç”»é¢å›ºæœ‰ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èª­ã¿è¾¼ã‚€ #}
<script src="{{ url_for('static', filename='js/checklist_toggle.js') }}"></script>
{% endblock %}