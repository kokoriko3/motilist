{# Shared plan header + tabs. Expects `active_tab` set to one of: transit, stay, schedule, checklist #}
{% set plan_title = plan_title if plan_title is defined and plan_title else (plan.destination if plan and plan.destination else (plan.title if plan and plan.title else 'プラン')) %}
{% set duration_text = duration_text if duration_text is defined and duration_text else (duration_label if duration_label is defined and duration_label else ((plan.days - 1)|string ~ '泊' ~ (plan.days|string) ~ '日' if plan and plan.days else '')) %}
{% set date_text = date_text if date_text is defined and date_text else (date_range_label if date_range_label is defined and date_range_label else (plan.start_date if plan and plan.start_date else '')) %}
{% set transit_url = plan_tab_transit_url if plan_tab_transit_url is defined and plan_tab_transit_url else (url_for('plan.plan_transit', plan_id=plan.id) if plan and plan.id else url_for('plan.plan_transit')) %}
{% set stay_url = plan_tab_stay_url if plan_tab_stay_url is defined and plan_tab_stay_url else (url_for('plan.stay_select', plan_id=plan.id) if plan and plan.id else url_for('plan.stay_select')) %}
{% set schedule_url = plan_tab_schedule_url if plan_tab_schedule_url is defined and plan_tab_schedule_url else (url_for('plan.schedule_list', plan_id=plan.id) if plan and plan.id else url_for('plan.schedule_list')) %}
{% set checklist_url = plan_tab_checklist_url if plan_tab_checklist_url is defined and plan_tab_checklist_url else (url_for('plan.checklist_list', plan_id=plan.id) if plan and plan.id else url_for('plan.checklist_list')) %}

{% set tabs = [
  ('transit', '交通手段', transit_url),
  ('stay', '宿泊場所', stay_url),
  ('schedule', 'スケジュール', schedule_url),
  ('checklist', '持ち物', checklist_url)
] %}

<div class="plan-header">
  <div>
    <p class="plan-title" data-plan-title="{{ plan_title }}">
      {{ plan_title }}
      {% if duration_text %}　{{ duration_text }}{% endif %}
      <span class="icon-inline" aria-hidden="true">✎</span>
    </p>
  </div>
  <div class="plan-meta">
    {% if date_text %}
    <span class="plan-date">{{ date_text }}</span>
    {% endif %}
    <button type="button" class="pill-button" data-plan-share-trigger>共有</button>
    <button type="button" class="pill-button" data-plan-save-trigger>保存</button>
  </div>
</div>

<div class="plan-tabs">
  {% for key, label, href in tabs %}
    {% if active_tab == key %}
      <a class="active">{{ label }}</a>
    {% else %}
      <a href="{{ href }}">{{ label }}</a>
    {% endif %}
  {% endfor %}
</div>
