{% extends "layout.html" %}
{% block title %}å®¿æ³Šå…ˆé¸æŠ{% endblock %}
{% block content %}
<section class="stay-shell">
  {% set active_tab = 'stay' %}
  {% include 'plan/_plan_header_tabs.html' %}

  <div class="stay-body">
    <h1>å®¿æ³Šå ´æ‰€å¤‰æ›´</h1>
    <div class="banner error-banner" data-stay-error hidden>ã‚¨ãƒ©ãƒ¼ãŒèµ·ãã¾ã—ãŸ æ™‚é–“ã‚’ãŠã„ã¦å†åº¦å®Ÿè¡Œã—ã¦ãã ã•ã„</div>
      {% set flash_messages = get_flashed_messages(with_categories=true) %}
      <div class="error-inline" data-transport-error {% if not flash_messages %}hidden{% endif %}>
        {% if flash_messages %}
          {{ flash_messages[0][1] }}
        {% else %}
          é¸æŠã—ã¦ãã ã•ã„
        {% endif %}
      </div>
    <div class="stay-toolbar">
      <div class="support-label">
        <!-- Rakuten Web Services Attribution Snippet FROM HERE -->
        <a href="https://webservice.rakuten.co.jp/" target="_blank"><img src="https://webservice.rakuten.co.jp/img/credit/200709/credit_22121.gif" border="0" alt="Rakuten Web Service Center" title="Rakuten Web Service Center" width="221" height="21"/></a>
        <!-- Rakuten Web Services Attribution Snippet TO HERE -->
      </div>
      <div class="stay-sort">
        <span class="sort-icon">ğŸ“¶</span>
        <button type="button" class="sort-button" data-sort-toggle>ä¸¦ã³æ›¿ãˆ</button>
        <div class="sort-menu" data-sort-menu hidden>
          <button type="button" data-sort="price-asc" {% if sort_key == 'price-asc' %}aria-current="true"{% endif %}>é‡‘é¡ æ˜‡é †</button>
          <button type="button" data-sort="price-desc" {% if sort_key == 'price-desc' %}aria-current="true"{% endif %}>é‡‘é¡ é™é †</button>
          <button type="button" data-sort="review-desc" {% if sort_key == 'review-desc' %}aria-current="true"{% endif %}>ãƒ¬ãƒ“ãƒ¥ãƒ¼é †</button>
        </div>
      </div>
    </div>

    <form action="{{ url_for('plan.stay_select') }}" method="post">
      <div class="stay-list" data-stay-list>
        {% for stay in stay_options %}
        <article
          class="stay-card {% if stay.is_selected %}selected{% endif %}"
          data-stay-id="{{ stay.id }}"
          data-price="{{ stay.price if stay.price is not none else "" }}"
          data-review="{{ stay.review if stay.review is not none else "" }}"
        >
          <label>
            <input
              type="radio"
              name="hotel_id"
              value="{{ stay.id }}"
              {% if stay.is_selected %}checked{% endif %}
            >
            <input
              type="checkbox"
              class="visually-hidden stay-checkbox"
              data-stay-checkbox
              value="{{ stay.id }}"
              {% if stay.is_selected %}checked{% endif %}
            >
            <div class="stay-card__main">
              <p class="stay-name">{{ stay.name }}</p>
              <p class="stay-price">
                {% if stay.price is not none %}
                  {{ "{:,}".format(stay.price) }}å††ã€œ
                {% else %}
                  -
                {% endif %}
              </p>
              <p class="stay-address">{{ stay.address }}</p>
            </div>
            <div class="stay-card__meta">
              <span class="stay-stars">
                {% if stay.review is not none %}
                  {% set star_count = stay.review|int %}
                  <span class="stay-stars__icons">{{ 'â˜…' * star_count }}</span>
                  <span class="stay-stars__score">{{ stay.review }}</span>
                {% else %}
                  -
                {% endif %}
              </span>
              {% if stay.url %}
                <a class="stay-detail" href="{{ stay.url }}" target="_blank" rel="noopener">è©³ç´° â†—</a>
              {% endif %}
            </div>
            <div class="stay-card__thumb">
              {% if stay.image_url %}
                <img src="{{ stay.image_url }}" alt="{{ stay.name }}">
              {% else %}
                <div class="stay-card__thumb--placeholder">No image</div>
              {% endif %}
            </div>
          </label>
        </article>
        {% endfor %}
      </div>

      <div class="stay-footer">
        <button type="button" class="pill-ghost" data-stay-clear>é¸æŠã—ãªã„</button>
        <div class="pager" data-stay-pager>
          {% set page_count = total_pages if total_pages > 1 else 1 %}
          {% for p in range(1, page_count + 1) %}
            <button type="button" class="pager-btn {% if p == page %}pager-current{% endif %}" data-page="{{ p }}">{{ p }}</button>
          {% endfor %}
        </div>
        <button type="submit" class="cta-primary" data-stay-confirm>ç¢ºå®š</button>
      </div>
    </form>
  </div>
</section>
<script defer src="{{ url_for('static', filename='js/stay.js') }}"></script>
{% endblock %}
